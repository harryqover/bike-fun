<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide de Vacances | Cap Ferret 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Chosen Palette: Cap Ferret Dune -->
    <!-- Application Structure Plan: J'ai con√ßu une application √† onglets pour une navigation rapide. L'ajout de l'onglet "Checklist Valises" avec une interaction IA (Gemini) offre un outil pratique et personnalis√© pour la pr√©paration du voyage. -->
    <!-- Visualization & Content Choices: 
        - Mar√©es -> Objectif: Montrer l'√©volution -> Viz: Tableau HTML + Graphique Chart.js -> Interaction: Survol -> Justification: Intuitif.
        - Plages/Activit√©s -> Objectif: Comparer et d√©tailler -> Viz: Cartes HTML/CSS -> Interaction: Clic pour ouvrir un modal avec plus d'infos -> Justification: Am√©liore la profondeur de l'information sans surcharger l'interface principale.
        - Carte -> Objectif: Localiser -> Viz: Carte interactive Leaflet.js -> Interaction: Clic sur marqueurs -> Justification: Essentiel pour la logistique.
        - Itin√©raires V√©lo -> Objectif: Guider -> Viz: Cartes descriptives HTML/CSS -> Justification: Fournit des plans d'excursion cl√©s en main.
        - Concours Cuisine -> Objectif: Organiser et inspirer -> Viz: Cartes journali√®res HTML/CSS -> Interaction: Clic sur bouton "Id√©es Recettes" pour appeler Gemini API et afficher une recette dans un modal -> Justification: Ajoute une fonctionnalit√© IA amusante et utile.
        - Checklist Valises -> Objectif: Aider √† la pr√©paration -> Viz: Formulaire HTML -> Interaction: Clic sur bouton pour appeler Gemini API avec le contexte du groupe et des √©quipements fournis, puis affiche une checklist structur√©e -> Justification: Outil intelligent et personnalis√© qui simplifie l'organisation.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background-color: #F5F5F4; /* stone-100 */
            font-family: 'Inter', sans-serif;
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            border-bottom-color: #0F766E; /* teal-700 */
            color: #134E4A; /* teal-900 */
            font-weight: 600;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
        #leaflet-map {
            height: 60vh;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-container {
            transition: transform 0.3s ease;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0F766E;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
    </style>
</head>
<body class="text-stone-800">

    <div class="container mx-auto p-4 md:p-6 max-w-7xl">

        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-900">Vos Vacances au Cap Ferret</h1>
            <p class="text-stone-600 mt-1">20 - 27 Juillet 2025 | Piraillan</p>
        </header>

        <nav class="flex justify-center flex-wrap gap-x-3 gap-y-2 md:gap-x-4 border-b border-stone-300 pb-2 mb-8">
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="today">Aujourd'hui</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="villa">La Villa</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="packing-checklist">Checklist Valises</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="kitchen-contest">Concours Cuisine</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="map">Carte</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="bike-routes">Itin√©raires V√©lo</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="beaches">Les Plages</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="activities">Activit√©s</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="practical">Vie Pratique</button>
            <button class="nav-link text-stone-600 hover:text-teal-800 px-1 py-2 text-sm md:text-base" data-tab="tides">Mar√©es</button>
        </nav>

        <main>
            <section id="today" class="content-section"></section>
            <section id="villa" class="content-section"></section>
            <section id="packing-checklist" class="content-section"></section>
            <section id="kitchen-contest" class="content-section"></section>
            <section id="map" class="content-section"></section>
            <section id="bike-routes" class="content-section"></section>
            <section id="beaches" class="content-section"></section>
            <section id="activities" class="content-section"></section>
            <section id="practical" class="content-section"></section>
            <section id="tides" class="content-section"></section>
        </main>

    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50" onclick="closeModal('details-modal')">
        <div class="modal-container bg-white rounded-lg shadow-xl max-w-2xl w-full transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center p-4 border-b border-stone-200">
                <h3 id="modal-title" class="text-xl font-bold text-teal-800"></h3>
                <button onclick="closeModal('details-modal')" class="text-3xl font-light leading-none text-stone-500 hover:text-stone-800">&times;</button>
            </div>
            <div id="modal-content" class="p-6 max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>
    
    <!-- Recipe Modal -->
    <div id="recipe-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50" onclick="closeModal('recipe-modal')">
        <div class="modal-container bg-white rounded-lg shadow-xl max-w-2xl w-full transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center p-4 border-b border-stone-200">
                <h3 id="recipe-modal-title" class="text-xl font-bold text-teal-800"></h3>
                <button onclick="closeModal('recipe-modal')" class="text-3xl font-light leading-none text-stone-500 hover:text-stone-800">&times;</button>
            </div>
            <div id="recipe-modal-content" class="p-6 max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>


    <script>
        const appData = {
            kitchenContest: [
                { day: "Lundi", team: "Benelepan", special: null },
                { day: "Mardi", team: "Chanorol", special: null },
                { day: "Mercredi", team: "Nonmygo", special: null },
                { day: "Jeudi", team: "Louflory", special: null },
                { day: "Vendredi", team: "Elchigus", special: "Sp√©cial ap√©ro concoct√© par les enfants ! ü•≥" }
            ],
            locations: [
                { lat: 44.7550, lng: -1.2250, name: "La Villa", type: "villa" },
                { lat: 44.7355, lng: -1.2352, name: "Plage de la Truquette", type: "plage" },
                { lat: 44.7290, lng: -1.2380, name: "Pointe aux Chevaux", type: "plage" },
                { lat: 44.7850, lng: -1.2500, name: "Plage du Truc Vert", type: "plage" },
                { lat: 44.6360, lng: -1.2530, name: "Plage de l'Horizon", type: "plage" },
                { lat: 44.6455, lng: -1.2500, name: "Plage des Am√©ricains", type: "plage" },
                { lat: 44.6388, lng: -1.2415, name: "Plage du Mimbeau", type: "plage" },
                { lat: 44.7185, lng: -1.2595, name: "Plage de la Garonne", type: "plage" },
                { lat: 44.7540, lng: -1.2260, name: "March√© de Piraillan", type: "commerce" },
                { lat: 44.7780, lng: -1.1980, name: "Super U Claouey", type: "commerce" },
                { lat: 44.7410, lng: -1.2310, name: "Poissonnerie de Piquey", type: "commerce" },
                { lat: 44.7400, lng: -1.2320, name: "Chez Patachou", type: "commerce" },
                { lat: 44.7530, lng: -1.2240, name: "La Cabane 57", type: "activite" },
                { lat: 44.7040, lng: -1.2430, name: "Village de l'Herbe", type: "activite" },
                { lat: 44.6320, lng: -1.2460, name: "Chez Boulan", type: "activite" },
                { lat: 44.6090, lng: -1.2470, name: "Le Phare du Cap Ferret", type: "activite" },
                { lat: 44.7700, lng: -1.1500, name: "R√©serve Naturelle des Pr√©s Sal√©s", type: "activite" },
                { lat: 44.7450, lng: -1.2280, name: "Tennis Club de Petit Piquey", type: "activite" },
            ],
            villa: {
                address: "64, avenue de Bellevue, Piraillan ‚Äì 33950 L√®ge-Cap-Ferret",
                contact: { name: "Yvan Sibadey", phone: "06 08 46 85 10" },
                description: "Villa de 200m¬≤ dans une impasse calme, expos√©e plein sud. Comprend 6 chambres, 2 dortoirs, 5 salles d'eau pour 22 couchages. Draps, serviettes et linge de maison fournis. Piscine chauff√©e.",
                rules: [
                    "Arriv√©e autonome avec une bo√Æte √† cl√© s√©curis√©e.",
                    "Caution de 2000‚Ç¨ via une empreinte bancaire Swikly (√† faire la veille de l'arriv√©e).",
                    "Respecter la qui√©tude du voisinage. La villa est un lieu de vill√©giature et non de f√™tes."
                ],
                amenities: {
                    "Cuisine & Salle √† Manger": ["Bouilloire", "Cafeti√®re", "Cong√©lateur", "Four", "Micro-ondes", "Grille-pain", "Lave-vaisselle", "R√©frig√©rateur", "Plaque de cuisson", "Ustensiles de barbecue", "Vaisselle", "Verres √† vin", "Chaise haute", "D√©tecteur de fum√©e", "Extincteur"],
                    "Chambre & Linge": ["Lave-linge", "S√®che-linge", "Serviettes, draps, savon, papier toilette", "Cintres", "Oreillers et couvertures suppl√©mentaires", "Fer √† repasser"],
                    "Pour la Famille": ["Lit pour b√©b√© (sur demande)", "Livres et jouets pour enfants", "Baignoire pour b√©b√©s (sur demande)", "Vaisselle pour enfants", "Table √† langer (sur demande)", "Recommandations de baby-sitters"],
                    "Ext√©rieur & Loisirs": ["Piscine chauff√©e & Jacuzzi", "Barbecue", "Mobilier d'ext√©rieur", "Hamac", "Chaises longues", "Table de ping-pong", "Parking gratuit (sur place et dans la rue)", "Wi-Fi", "Syst√®me audio"]
                }
            },
            tides: [
                { date: "Dim 20 Juil.", dayIndex: 0, pmMatin: "01:15 (3.46m)", pmSoir: "13:54 (3.41m)", coeff: "52", conseil: "Mar√©es douces. Pleine mer en d√©but d'apr√®s-midi, parfaite pour une premi√®re baignade tranquille." },
                { date: "Lun 21 Juil.", dayIndex: 1, pmMatin: "02:32 (3.46m)", pmSoir: "15:05 (3.55m)", coeff: "56-59", conseil: "Pleine mer en milieu d'apr√®s-midi. Id√©al apr√®s la sieste des petits." },
                { date: "Mar 22 Juil.", dayIndex: 2, pmMatin: "03:43 (3.54m)", pmSoir: "16:08 (3.72m)", coeff: "64-69", conseil: "Les mar√©es se renforcent. Belle lumi√®re dor√©e pour une longue session sur le sable." },
                { date: "Mer 23 Juil.", dayIndex: 3, pmMatin: "04:44 (3.66m)", pmSoir: "17:04 (3.89m)", coeff: "73-78", conseil: "Excellentes conditions. Envisagez un pique-nique pour le d√Æner sur la plage." },
                { date: "Jeu 24 Juil.", dayIndex: 4, pmMatin: "05:55 (3.93m)", pmSoir: "18:15 (4.20m)", coeff: "82-85", conseil: "Tr√®s fortes mar√©es. La pleine mer du soir sera spectaculaire." },
                { date: "Ven 25 Juil.", dayIndex: 5, pmMatin: "06:43 (4.04m)", pmSoir: "19:02 (4.30m)", coeff: "87-89", conseil: "Pic des mar√©es ! L'eau sera √† son plus haut et plus clair. Jour parfait pour la Pointe aux Chevaux." },
                { date: "Sam 26 Juil.", dayIndex: 6, pmMatin: "07:27 (4.07m)", pmSoir: "19:45 (4.32m)", coeff: "89", conseil: "Encore des mar√©es exceptionnelles. Id√©al pour une d√©gustation d'hu√Ætres au coucher du soleil." },
                { date: "Dim 27 Juil.", dayIndex: 7, pmMatin: "08:07 (4.04m)", pmSoir: "20:24 (4.24m)", coeff: "89-87", conseil: "Magnifique pleine mer matinale pour une derni√®re baignade avant le d√©part." }
            ],
            beaches: [
                { type: 'bassin', name: 'Plage de la Truquette', location: 'Petit Piquey', time: '10 min', icon: 'üë∂', description: 'Calme et discr√®te, id√©ale pour les familles avec ses tables de pique-nique √† l\'ombre des pins.', color: 'bg-sky-100', textColor: 'text-sky-800', details: { conseil: "Parfaite pour les tout-petits √† mar√©e haute. L'eau est peu profonde et chaude. √Ä mar√©e basse, pr√©voyez des chaussures pour marcher sur l'estran.", services: "Tables de pique-nique, ombre des pins. Pas de restauration directe sur la plage mais le village est proche." } },
                { type: 'bassin', name: 'Pointe aux Chevaux', location: 'Grand Piquey', time: '15 min', icon: '‚≠ê', description: 'Consid√©r√©e comme la plus belle plage, avec ses cabanes authentiques et une vue imprenable.', color: 'bg-sky-100', textColor: 'text-sky-800', details: { conseil: "Le spot photo par excellence au coucher du soleil. L'acc√®s se m√©rite par un petit sentier, moins pratique avec une poussette.", services: "D√©gustations d'hu√Ætres √† proximit√©. Pas de surveillance." } },
                { type: 'bassin', name: 'Plage des Am√©ricains', location: 'Le Canon', time: '25 min', icon: '‚öì', description: 'Reconnaissable √† sa longue jet√©e, elle offre un charme surann√© et une vue magnifique.', color: 'bg-sky-100', textColor: 'text-sky-800', details: { conseil: "Id√©ale pour la p√™che √† pied √† mar√©e basse. La jet√©e est un super poste d'observation.", services: "Proximit√© des commerces et restaurants du Canon." } },
                { type: 'bassin', name: 'Plage du Mimbeau', location: 'Village Cap Ferret', time: '40 min', icon: 'üêö', description: 'Une langue de sable unique qui forme une lagune int√©rieure, face √† la Dune du Pilat.', color: 'bg-sky-100', textColor: 'text-sky-800', details: { conseil: "Magnifique balade √† faire le long de la conche du Mimbeau. L'eau y est tr√®s calme et chaude.", services: "Cabanes de d√©gustation et restaurants √† proximit√©." } },
                { type: 'ocean', name: 'Plage du Truc Vert', location: 'For√™t', time: '20-25 min', icon: 'üèÑ', description: 'Cadre sauvage et magnifique, accessible par la for√™t. √âcoles de surf et restauration.', color: 'bg-indigo-100', textColor: 'text-indigo-800', details: { conseil: "Respectez imp√©rativement les zones de baignade surveill√©e (entre les drapeaux). Les vagues peuvent √™tre puissantes.", services: "Poste de secours, √©coles de surf, location de mat√©riel, snacks/restaurants." } },
                { type: 'ocean', name: 'Plage de la Garonne', location: 'Entre Le Truc Vert et l\'Horizon', time: '30 min', icon: 'üåø', description: 'Moins fr√©quent√©e que ses voisines, elle offre un sentiment de solitude et de nature brute.', color: 'bg-indigo-100', textColor: 'text-indigo-800', details: { conseil: "Plage non surveill√©e, la prudence est de mise. Id√©ale pour les grandes marches au bord de l'eau.", services: "Aucun service, c'est la nature √† l'√©tat pur." } },
                { type: 'ocean', name: 'Plage de l\'Horizon', location: 'Village Cap Ferret', time: '35-45 min', icon: 'üöÇ', description: 'Accessible par le Petit Train. Proche des commerces et restaurants du village.', color: 'bg-indigo-100', textColor: 'text-indigo-800', details: { conseil: "L'option la plus 'civilis√©e' des plages oc√©anes. Le trajet en petit train est une attraction en soi pour les enfants.", services: "Poste de secours, restaurants, boutiques, toilettes publiques." } }
            ],
            activities: {
                "D√©gustations d'Hu√Ætres": [
                    { name: 'La Cabane 57', location: 'Port de Piraillan', description: 'Cadre idyllique avec vue sur l\'√éle aux Oiseaux. Juste √† c√¥t√© de la villa !', details: { reservation: "Fortement recommand√©e, surtout pour un groupe. Appelez en avance.", budget: "Environ 15-25‚Ç¨ par personne pour une douzaine d'hu√Ætres et un verre de vin." } },
                    { name: 'Village de l\'Herbe', location: 'L\'Herbe', description: 'Plusieurs cabanes r√©put√©es (Le Ponton, Chez Guillaume...) dans un cadre photog√©nique.', details: { reservation: "Indispensable en saison. Chaque cabane a sa propre atmosph√®re.", budget: "Similaire aux autres cabanes, varie l√©g√®rement selon le producteur." } }
                ],
                "Excursions & Visites": [
                    { name: 'Sortie en Bateau', location: 'Bassin d\'Arcachon', description: 'Louez une pinasse ou un catamaran pour explorer le bassin.', details: { reservation: "Essentielle, √† pr√©voir bien avant le s√©jour. Contacter les bateliers locaux.", budget: "Variable. Compter plusieurs centaines d'euros pour la privatisation d'une pinasse pour une demi-journ√©e." } },
                    { name: 'Le Phare du Cap Ferret', location: 'Village Cap Ferret', description: '258 marches pour une vue √† 360¬∞ inoubliable sur toute la presqu\'√Æle.', details: { reservation: "Pas de r√©servation n√©cessaire. √âviter les heures de pointe (11h-16h).", budget: "Tarifs 2024 : 7‚Ç¨/adulte, 4‚Ç¨/enfant. Gratuit pour les moins de 4 ans." } }
                ],
                "Sports & Nature": [
                    { name: 'R√©serve Naturelle des Pr√©s Sal√©s', location: 'Ar√®s/L√®ge', description: 'Explorez √† pied ou √† v√©lo cet espace naturel prot√©g√© unique, entre terre et mer.', details: { conseil: "Id√©al pour l'observation des oiseaux. Pr√©voir des jumelles. L'acc√®s est libre.", budget: "Gratuit." } },
                    { name: 'Tennis Club de Petit Piquey', location: 'Petit Piquey', description: 'Pour une partie de tennis ou de padel dans un cadre agr√©able.', details: { reservation: "R√©servation des courts en ligne ou par t√©l√©phone indispensable en √©t√©.", budget: "Variable selon la location du court." } }
                ]
            },
            practical: {
                "March√©s & Supermarch√©s": [ 
                    { name: 'March√© de Piraillan', description: 'Le c≈ìur du village. Ouvert tous les matins.', address: 'Piraillan', hours: 'Tous les jours : 8h00 - 13h00' }, 
                    { name: 'Super U Claouey', description: 'Pour le grand ravitaillement d\'arriv√©e.', address: 'Avenue des Halles, Claouey', hours: 'Lun-Sam : 8h30 - 20h00, Dim : 8h30 - 13h00' } 
                ],
                "Commerces de Bouche": [ 
                    { name: 'Poissonnerie de Piquey', description: 'Poissons et fruits de mer frais.', address: '24 rte de Bordeaux, Petit Piquey', hours: 'Mar-Dim : 9h00 - 13h00 / 17h00 - 19h30' }, 
                    { name: 'Chez Patachou', description: 'P√¢tissier, traiteur, glacier.', address: '64 rte de Bordeaux, Petit Piquey', hours: 'Mer-Lun : 7h00 - 19h45 (ferm√© le mardi)' } 
                ],
                "Sant√© & Services": [ 
                    { name: 'Pharmacie de Petit Piquey', description: 'La plus proche.', address: '45 Route de Bordeaux, Petit Piquey', hours: 'Lun-Sam : 8h30 - 12h15 / 14h00 - 19h15' } 
                ]
            },
            bikeRoutes: [
                { title: "La Boucle des Villages Ostr√©icoles", distance: "15 km (A/R)", difficulty: "Facile", description: "Une balade familiale au c≈ìur de la vie de la presqu'√Æle, parfaite pour une matin√©e.", steps: ["D√©part de Piraillan, direction sud sur la piste cyclable principale.", "Arr√™t au village du Canon pour admirer les cabanes color√©es et la vue sur le bassin.", "Continuez jusqu'au village de l'Herbe. Garez les v√©los et perdez-vous dans les ruelles fleuries.", "Visitez la Chapelle de la Villa Alg√©rienne, un joyau architectural.", "Option : terminez par une d√©gustation d'hu√Ætres √† l'Herbe avant de rentrer."] },
                { title: "L'Exploration Oc√©ane via la For√™t", distance: "20 km (A/R)", difficulty: "Moyen", description: "Une immersion dans la nature sauvage du Cap Ferret, entre for√™t de pins et immensit√© de l'oc√©an.", steps: ["D√©part de Piraillan, direction la piste foresti√®re vers le Truc Vert.", "Profitez de l'ombre et des odeurs de la pin√®de sur ce parcours s√©curis√©.", "Arriv√©e √† la plage du Truc Vert. Garez les v√©los et montez la dune pour une vue spectaculaire.", "Pause baignade (surveill√©e) et pique-nique sur la plage.", "Retour par le m√™me chemin, en profitant de la lumi√®re de fin d'apr√®s-midi."] }
            ]
        };

        let activeTab = 'today';
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        let mapInstance = null;
        
        const pageRenderers = {
            today: renderToday,
            villa: renderVilla,
            'packing-checklist': renderPackingChecklist,
            'kitchen-contest': renderKitchenContest,
            map: renderMap,
            'bike-routes': renderBikeRoutes,
            beaches: renderBeaches,
            activities: renderActivities,
            practical: renderPractical,
            tides: renderTides,
        };

        async function callGemini(prompt, jsonSchema = null) {
            const apiKey = "AIzaSyDfml1kLimj-q0WEsteNYtAEbI43YmdxeQ"; 
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            let payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }]
            };

            if (jsonSchema) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: jsonSchema
                };
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Invalid response structure from API.");
                }
            } catch (error) {
                console.error("Gemini API call error:", error);
                return null;
            }
        }

        function updateView() {
            navLinks.forEach(link => link.classList.toggle('active', link.dataset.tab === activeTab));
            contentSections.forEach(section => section.classList.toggle('active', section.id === activeTab));
            
            if (pageRenderers[activeTab]) {
                const section = document.getElementById(activeTab);
                if (section.innerHTML.trim() === '') {
                    pageRenderers[activeTab](section);
                }
            }

            if (activeTab === 'map' && mapInstance) {
                setTimeout(() => mapInstance.invalidateSize(), 10);
            }
        }
        
        function renderToday(container) {
            const today = new Date(2025, 6, 21); // For demo purpose, using a fixed date
            const dayOfWeek = today.getDay();
            const todayTide = appData.tides.find(t => t.dayIndex === dayOfWeek);
            let content = '';
            if (todayTide) {
                content = `
                    <p class="text-stone-600 mb-4 text-lg">Aujourd'hui, <strong>${todayTide.date}</strong>.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                        <div class="bg-sky-50 p-4 rounded-lg"><h3 class="font-semibold text-sky-800">Pleine Mer du Matin</h3><p class="text-2xl font-bold text-sky-700">${todayTide.pmMatin}</p></div>
                        <div class="bg-sky-50 p-4 rounded-lg"><h3 class="font-semibold text-sky-800">Pleine Mer de l'Apr√®s-midi</h3><p class="text-2xl font-bold text-sky-700">${todayTide.pmSoir}</p></div>
                    </div>
                    <div class="mt-6 bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg text-left"><h4 class="font-bold text-amber-900">Le conseil du jour :</h4><p class="text-amber-800 mt-1">${todayTide.conseil}</p></div>
                    <div class="mt-6 text-center">
                        <button onclick="generateActivitySuggestion()" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-full hover:bg-teal-700 transition-colors">‚ú® Sugg√©rer une activit√©</button>
                    </div>
                    <div id="activity-suggestion" class="mt-4 text-left"></div>
                    `;
            } else {
                 content = `<p class="text-stone-600">Les informations pour aujourd'hui seront disponibles au d√©but de votre s√©jour.</p>`;
            }
            container.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-lg border border-stone-200"><h2 class="text-2xl font-bold text-teal-800 mb-4 text-center">Plan du Jour</h2><div class="text-center">${content}</div></div>`;
        }

        async function generateActivitySuggestion() {
            const suggestionBox = document.getElementById('activity-suggestion');
            suggestionBox.innerHTML = '<div class="flex justify-center"><div class="loader"></div></div>';
            
            const today = new Date(2025, 6, 21);
            const dayOfWeek = today.getDay();
            const todayTide = appData.tides.find(t => t.dayIndex === dayOfWeek);

            if (!todayTide) {
                suggestionBox.innerHTML = '<p class="text-red-500">Impossible de r√©cup√©rer les informations de mar√©e.</p>';
                return;
            }

            const prompt = `Tu es un guide touristique pour des vacances en famille au Cap Ferret. Aujourd'hui, nous sommes ${todayTide.date}. La mar√©e haute du matin est √† ${todayTide.pmMatin} et celle de l'apr√®s-midi √† ${todayTide.pmSoir}. Le coefficient est de ${todayTide.coeff}. Propose un court programme d'activit√© pour la journ√©e (matin et apr√®s-midi) pour un grand groupe familial avec des jeunes enfants et des grands-parents. Sois cr√©atif et tiens compte des mar√©es pour les activit√©s de plage.`;

            const suggestion = await callGemini(prompt);

            if (suggestion) {
                suggestionBox.innerHTML = `<div class="bg-stone-50 p-4 rounded-lg"><h4 class="font-bold text-teal-900">Suggestion du jour :</h4><p class="text-stone-700 mt-2 whitespace-pre-wrap">${suggestion}</p></div>`;
            } else {
                suggestionBox.innerHTML = '<p class="text-red-500 text-center">D√©sol√©, une erreur est survenue lors de la g√©n√©ration de la suggestion. Veuillez r√©essayer.</p>';
            }
        }

        function renderVilla(container) {
            const villa = appData.villa;
            const infoCard = `
                <div>
                    <h3 class="font-bold text-xl text-teal-800 mb-2">Informations G√©n√©rales</h3>
                    <p class="font-semibold">${villa.address}</p>
                    <p class="text-sm text-stone-600 mt-2">${villa.description}</p>
                </div>
                <div><h4 class="font-semibold text-teal-900">Contact Propri√©taire :</h4><p class="text-stone-700">${villa.contact.name} - ${villa.contact.phone}</p></div>
                <div><h4 class="font-semibold text-teal-900">R√®gles & Infos Cl√©s :</h4><ul class="list-disc list-inside text-sm text-stone-700 space-y-1 mt-1">${villa.rules.map(rule => `<li>${rule}</li>`).join('')}</ul></div>`;
            
            let amenitiesHtml = '';
            for (const category in villa.amenities) {
                amenitiesHtml += `<div>
                    <h3 class="font-bold text-xl text-teal-800 mb-3">${category}</h3>
                    <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm text-stone-700">${villa.amenities[category].map(item => `<span class="bg-stone-100 px-2 py-1 rounded-full">${item}</span>`).join('')}</div>
                </div>`;
            }
            container.innerHTML = `
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-teal-800 mb-2">Votre Havre de Paix</h2><p class="text-stone-600 max-w-2xl mx-auto">Toutes les informations sur votre maison de vacances.</p></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-lg border border-stone-200 space-y-4">${infoCard}</div>
                    <div class="bg-white p-6 rounded-lg shadow-lg border border-stone-200 space-y-4">${amenitiesHtml}</div>
                </div>`;
        }
        
        function renderPackingChecklist(container) {
            container.innerHTML = `
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-teal-800 mb-2">Checklist Valises Intelligente</h2>
                    <p class="text-stone-600 max-w-2xl mx-auto">Indiquez qui participe au voyage et laissez l'IA vous cr√©er une checklist personnalis√©e, en tenant compte de ce qui est d√©j√† fourni dans la villa !</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg border border-stone-200 max-w-3xl mx-auto">
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label for="adults-input" class="block text-sm font-medium text-stone-700">Adultes</label>
                            <input type="number" id="adults-input" value="10" min="0" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="children-input" class="block text-sm font-medium text-stone-700">Enfants (2-12 ans)</label>
                            <input type="number" id="children-input" value="3" min="0" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="babies-input" class="block text-sm font-medium text-stone-700">B√©b√©s (0-2 ans)</label>
                            <input type="number" id="babies-input" value="2" min="0" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm">
                        </div>
                    </div>
                    <div class="text-center">
                        <button onclick="generatePackingChecklist()" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-full hover:bg-teal-700 transition-colors">‚ú® Cr√©er ma checklist</button>
                    </div>
                    <div id="checklist-result" class="mt-6"></div>
                </div>
            `;
        }

        async function generatePackingChecklist() {
            const resultDiv = document.getElementById('checklist-result');
            resultDiv.innerHTML = '<div class="flex justify-center"><div class="loader"></div></div>';

            const adults = document.getElementById('adults-input').value;
            const children = document.getElementById('children-input').value;
            const babies = document.getElementById('babies-input').value;

            const providedItems = Object.values(appData.villa.amenities).flat().join(', ');

            const prompt = `Tu es un assistant de voyage expert. Cr√©e une checklist d√©taill√©e des choses √† ne pas oublier pour des vacances d'une semaine en juillet au Cap Ferret, France, pour un groupe de ${adults} adultes, ${children} enfants (2-12 ans), et ${babies} b√©b√©s (0-2 ans). Le groupe a d√©j√† des v√©los.
            IMPORTANT: La villa fournit d√©j√† les √©l√©ments suivants, il ne faut donc PAS les inclure dans la checklist : ${providedItems}.
            Organise la checklist par cat√©gories claires.`;

            const schema = {
                type: "OBJECT",
                properties: {
                    "essentiels": { type: "ARRAY", items: { type: "STRING" }, description: "Documents et articles indispensables" },
                    "vetements_adultes": { type: "ARRAY", items: { type: "STRING" }, description: "V√™tements et accessoires pour les adultes" },
                    "vetements_enfants": { type: "ARRAY", items: { type: "STRING" }, description: "V√™tements et accessoires pour les enfants" },
                    "pour_les_bebes": { type: "ARRAY", items: { type: "STRING" }, description: "√âquipement sp√©cifique pour les b√©b√©s" },
                    "pour_la_plage_et_piscine": { type: "ARRAY", items: { type: "STRING" }, description: "Affaires pour la baignade et la plage" },
                    "pharmacie_et_soins": { type: "ARRAY", items: { type: "STRING" }, description: "Trousse de secours et produits d'hygi√®ne" },
                    "divers": { type: "ARRAY", items: { type: "STRING" }, description: "Autres objets utiles" }
                },
                required: ["essentiels", "vetements_adultes", "vetements_enfants", "pour_les_bebes", "pour_la_plage_et_piscine", "pharmacie_et_soins", "divers"]
            };

            const resultText = await callGemini(prompt, schema);

            if (resultText) {
                try {
                    const checklist = JSON.parse(resultText);
                    let checklistHtml = '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
                    const categoryTitles = {
                        essentiels: "üìù Essentiels",
                        vetements_adultes: "üëï V√™tements Adultes",
                        vetements_enfants: "üëß V√™tements Enfants",
                        pour_les_bebes: "üçº Pour les B√©b√©s",
                        pour_la_plage_et_piscine: "üèñÔ∏è Pour la Plage & Piscine",
                        pharmacie_et_soins: "ü©π Pharmacie & Soins",
                        divers: "üîå Divers"
                    };

                    for (const category in checklist) {
                        if (checklist[category] && checklist[category].length > 0) {
                            checklistHtml += `<div><h4 class="font-bold mb-2 text-teal-800">${categoryTitles[category] || category}</h4><ul class="list-disc list-inside text-stone-700 space-y-1 text-sm">`;
                            checklist[category].forEach(item => {
                                checklistHtml += `<li>${item}</li>`;
                            });
                            checklistHtml += '</ul></div>';
                        }
                    }
                    checklistHtml += '</div>';
                    resultDiv.innerHTML = checklistHtml;
                } catch (e) {
                    resultDiv.innerHTML = `<p class="text-red-500">Erreur lors du formatage de la checklist.</p>`;
                }
            } else {
                resultDiv.innerHTML = '<p class="text-red-500 text-center">D√©sol√©, une erreur est survenue lors de la g√©n√©ration de la checklist. Veuillez r√©essayer.</p>';
            }
        }
        
        function renderKitchenContest(container) {
            let contestHtml = appData.kitchenContest.map(entry => {
                const specialClass = entry.special ? 'bg-amber-100 border-amber-400' : 'bg-white';
                const specialContent = entry.special ? `<p class="text-sm text-amber-800 font-medium mt-2">${entry.special}</p>` : '';
                return `
                <div class="p-6 rounded-lg shadow-lg border flex flex-col justify-between ${specialClass}">
                    <div>
                        <p class="text-sm font-semibold text-teal-800">${entry.day}</p>
                        <p class="text-2xl font-bold text-stone-800 mt-1">${entry.team}</p>
                        ${specialContent}
                    </div>
                    <button onclick="showRecipeGenerator('${entry.team}')" class="mt-4 bg-teal-50 text-teal-700 font-semibold py-2 px-3 rounded-full hover:bg-teal-100 transition-colors text-sm w-full flex items-center justify-center gap-2">
                        ‚ú® Id√©es Recettes
                    </button>
                </div>
            `}).join('');

            container.innerHTML = `
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-teal-800 mb-2">Concours Cuisine Piraillan</h2>
                    <p class="text-stone-600 max-w-2xl mx-auto">Le planning des √©quipes de chefs pour la semaine. Que le meilleur gagne !</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">${contestHtml}</div>
            `;
        }
        
        async function showRecipeGenerator(teamName) {
            const modal = document.getElementById('recipe-modal');
            const modalTitle = modal.querySelector('#recipe-modal-title');
            const modalContent = modal.querySelector('#recipe-modal-content');

            modalTitle.textContent = `Id√©e recette pour l'√©quipe ${teamName}`;
            modalContent.innerHTML = '<div class="flex justify-center"><div class="loader"></div></div>';
            openModal('recipe-modal');
            
            const prompt = `Tu es un assistant culinaire pour des vacances en famille au Cap Ferret, France. Propose une id√©e de recette simple et conviviale pour un grand groupe (environ 15 adultes et 5 enfants) pour l'√©quipe qui s'appelle '${teamName}'. La recette doit √™tre de saison (juillet) et si possible utiliser des produits locaux du Cap Ferret (poissons, hu√Ætres, etc.).`;
            const schema = {
                type: "OBJECT",
                properties: {
                    title: { type: "STRING" },
                    description: { type: "STRING" },
                    ingredients: { type: "ARRAY", items: { type: "STRING" } },
                    steps: { type: "ARRAY", items: { type: "STRING" } }
                },
                required: ["title", "description", "ingredients", "steps"]
            };

            const resultText = await callGemini(prompt, schema);

            if (resultText) {
                try {
                    const recipe = JSON.parse(resultText);
                    let recipeHtml = `
                        <h4 class="text-xl font-bold text-stone-800">${recipe.title}</h4>
                        <p class="text-stone-600 mt-2 mb-4">${recipe.description}</p>
                        <h5 class="font-bold mt-4 mb-2 text-teal-800">Ingr√©dients :</h5>
                        <ul class="list-disc list-inside text-stone-700 space-y-1">
                            ${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}
                        </ul>
                        <h5 class="font-bold mt-4 mb-2 text-teal-800">Pr√©paration :</h5>
                        <ol class="list-decimal list-inside text-stone-700 space-y-2">
                            ${recipe.steps.map(s => `<li>${s}</li>`).join('')}
                        </ol>
                    `;
                    modalContent.innerHTML = recipeHtml;
                } catch (e) {
                     modalContent.innerHTML = `<p class="text-red-500">Erreur lors du formatage de la recette.</p><p class="text-xs text-stone-500 mt-4">${resultText}</p>`;
                }
            } else {
                modalContent.innerHTML = '<p class="text-red-500 text-center">D√©sol√©, une erreur est survenue lors de la g√©n√©ration de la recette. Veuillez r√©essayer.</p>';
            }
        }

        function renderMap(container) {
            container.innerHTML = `
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-teal-800 mb-2">Carte de la Presqu'√Æle</h2><p class="text-stone-600 max-w-2xl mx-auto">Explorez les environs ! Tous les points d'int√©r√™t sont sur la carte.</p></div>
                <div id="leaflet-map"></div>`;
            
            if (mapInstance) mapInstance.remove();
            mapInstance = L.map('leaflet-map').setView([44.72, -1.23], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(mapInstance);
            
            const iconColors = { villa: 'red', plage: 'blue', commerce: 'green', activite: 'purple' };
            appData.locations.forEach(loc => {
                const icon = new L.Icon({
                    iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${iconColors[loc.type]}.png`,
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
                });
                L.marker([loc.lat, loc.lng], {icon: icon}).addTo(mapInstance).bindPopup(`<b>${loc.name}</b>`);
            });
        }

        function renderBikeRoutes(container) {
            let routesHtml = appData.bikeRoutes.map(route => `
                <div class="bg-white p-6 rounded-lg shadow-lg border border-stone-200">
                    <h3 class="font-bold text-xl text-teal-800">${route.title}</h3>
                    <div class="flex items-center gap-4 text-sm text-stone-600 my-2">
                        <span><strong>Distance :</strong> ${route.distance}</span>
                        <span><strong>Difficult√© :</strong> ${route.difficulty}</span>
                    </div>
                    <p class="text-stone-700 mb-4">${route.description}</p>
                    <h4 class="font-semibold mb-2">√âtapes sugg√©r√©es :</h4>
                    <ul class="list-decimal list-inside space-y-1 text-sm text-stone-600">${route.steps.map(step => `<li>${step}</li>`).join('')}</ul>
                </div>
            `).join('');
            container.innerHTML = `
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-teal-800 mb-2">Id√©es de Balades √† V√©lo</h2><p class="text-stone-600 max-w-2xl mx-auto">Le v√©lo est roi sur la presqu'√Æle. Voici deux itin√©raires pour d√©couvrir ses diff√©rentes facettes.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">${routesHtml}</div>`;
        }

        function renderBeaches(container) {
            let beachesHtml = appData.beaches.map((beach, index) => `
                <div onclick="showDetails('beach', ${index})" class="cursor-pointer border rounded-lg p-4 shadow-sm transition-transform hover:scale-105 ${beach.color} ${beach.textColor}">
                    <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-lg">${beach.name}</h3><span class="text-3xl">${beach.icon}</span></div>
                    <p class="text-sm font-semibold opacity-80 mb-3">${beach.location} - <span class="font-normal">V√©lo: ~${beach.time}</span></p>
                    <p class="text-sm">${beach.description}</p>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-teal-800 mb-2">L'Appel de l'Eau</h2>
                    <p class="text-stone-600 max-w-2xl mx-auto">Cliquez sur une plage pour plus de d√©tails. Bassin pour le calme, Oc√©an pour les vagues.</p>
                </div>
                <div id="beaches-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${beachesHtml}</div>`;
        }

        function renderActivities(container) {
            let activitiesHtml = '';
            for (const category in appData.activities) {
                activitiesHtml += `<div class="bg-white p-6 rounded-lg shadow-lg border border-stone-200">
                    <h3 class="font-bold text-xl text-teal-800 mb-4 border-b pb-2">${category}</h3>
                    <ul class="space-y-4">
                        ${appData.activities[category].map((item, index) => `
                            <li onclick="showDetails('activity', '${category}', ${index})" class="flex items-start gap-3 cursor-pointer p-2 -m-2 rounded-lg hover:bg-stone-100">
                               <span class="text-teal-600 mt-1 font-bold">‚ñ™</span>
                               <div><h4 class="font-semibold">${item.name}</h4><p class="text-sm text-stone-600">${item.description}</p></div>
                            </li>`).join('')}
                    </ul>
                </div>`;
            }
            container.innerHTML = `
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-teal-800 mb-2">Activit√©s & D√©couvertes</h2><p class="text-stone-600 max-w-2xl mx-auto">Cliquez sur une activit√© pour obtenir des conseils pratiques.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">${activitiesHtml}</div>`;
        }
        
        function renderPractical(container) {
            let practicalHtml = '';
            for (const category in appData.practical) {
                practicalHtml += `<div class="bg-white p-4 rounded-lg shadow-sm border border-stone-200">
                    <h3 class="font-bold text-lg text-teal-800 mb-3">${category}</h3>
                    <div class="space-y-3">
                        ${appData.practical[category].map(item => `<div class="text-sm">
                            <p class="font-semibold">${item.name}</p>
                            <p class="text-stone-600">${item.description}</p>
                            <p class="text-xs text-stone-500 mt-1">${item.address}</p>
                            <p class="text-xs text-teal-700 font-medium">${item.hours}</p>
                        </div>`).join('')}
                    </div>
                </div>`;
            }
            container.innerHTML = `
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-teal-800 mb-2">Vie Pratique √† Piraillan</h2><p class="text-stone-600 max-w-2xl mx-auto">Les adresses essentielles pour le quotidien.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${practicalHtml}</div>`;
        }
        
        function renderTides(container) {
            const tableRows = appData.tides.map((tide, index) => `<tr class="${index % 2 === 0 ? 'bg-white' : 'bg-stone-50'}">
                <td class="px-4 py-3 font-semibold">${tide.date}</td><td class="px-4 py-3 text-center">${tide.pmMatin}</td>
                <td class="px-4 py-3 text-center">${tide.pmSoir}</td><td class="px-4 py-3 text-center font-bold text-teal-700">${tide.coeff}</td>
                <td class="px-4 py-3 text-stone-700">${tide.conseil}</td></tr>`).join('');
            
            container.innerHTML = `
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-teal-800 mb-2">Le Rythme des Mar√©es</h2><p class="text-stone-600 max-w-2xl mx-auto">L'outil indispensable pour planifier vos journ√©es c√¥t√© Bassin.</p></div>
                <div class="bg-white p-4 rounded-lg shadow-lg border border-stone-200 mb-8"><div class="chart-container"><canvas id="tidesChart"></canvas></div></div>
                <div class="overflow-x-auto bg-white p-4 rounded-lg shadow-lg border border-stone-200"><table class="w-full text-sm text-left text-stone-600">
                    <thead class="text-xs text-teal-800 uppercase bg-stone-50"><tr><th scope="col" class="px-4 py-3">Date</th><th scope="col" class="px-4 py-3 text-center">Pleine Mer (Matin)</th><th scope="col" class="px-4 py-3 text-center">Pleine Mer (Soir)</th><th scope="col" class="px-4 py-3 text-center">Coeff.</th><th scope="col" class="px-4 py-3">Conseil du Jour</th></tr></thead>
                    <tbody>${tableRows}</tbody></table></div>`;
            
            createTidesChart();
        }

        function createTidesChart() {
            const ctx = document.getElementById('tidesChart').getContext('2d');
            const labels = appData.tides.map(t => t.date.slice(0, -5));
            const pmSoirHeights = appData.tides.map(t => parseFloat(t.pmSoir.match(/\((.*?)\m\)/)[1]));
            const coeffs = appData.tides.map(t => parseInt(t.coeff.split('-')[0]));

            new Chart(ctx, {
                type: 'line', data: { labels: labels, datasets: [ { label: 'Pleine Mer (m)', data: pmSoirHeights, borderColor: '#0F766E', backgroundColor: 'rgba(15, 118, 110, 0.1)', fill: true, tension: 0.3, yAxisID: 'y' }, { label: 'Coefficient', data: coeffs, borderColor: '#F97316', backgroundColor: 'transparent', borderDash: [5, 5], tension: 0.3, yAxisID: 'y1' } ] },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false, }, scales: { y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Hauteur (m)' }, grid: { drawOnChartArea: false } }, y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Coefficient' }, grid: { drawOnChartArea: false } } }, plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y}${ctx.dataset.yAxisID === 'y' ? 'm' : ''}` } } } }
            });
        }
        
        function showDetails(type, ...args) {
            let item;
            if (type === 'beach') {
                item = appData.beaches[args[0]];
            } else if (type === 'activity') {
                item = appData.activities[args[0]][args[1]];
            }
            if (!item || !item.details) return;
            
            let contentHtml = Object.entries(item.details).map(([key, value]) => `
                <h4 class="font-semibold text-teal-900 capitalize mt-4 mb-1">${key.replace(/([A-Z])/g, ' $1')}</h4>
                <p class="text-stone-700 text-sm">${value}</p>
            `).join('');
            
            openModal('details-modal', item.name, contentHtml);
        }
        
        function openModal(modalId, title, content) {
            const modal = document.getElementById(modalId);
            if (title) modal.querySelector(`#${modalId === 'details-modal' ? 'modal-title' : 'recipe-modal-title'}`).textContent = title;
            if (content) modal.querySelector(`#${modalId === 'details-modal' ? 'modal-content' : 'recipe-modal-content'}`).innerHTML = content;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('.modal-container').classList.remove('scale-95');
            }, 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('opacity-0');
            modal.querySelector('.modal-container').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }

        document.addEventListener('DOMContentLoaded', () => {
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    activeTab = link.dataset.tab;
                    updateView();
                });
            });
            
            // Set initial view
            document.querySelector('.nav-link[data-tab="today"]').click();
        });

    </script>
</body>
</html>
