<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Microlino Quote Request</title>
  <!-- Example Google Font import (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap"
    rel="stylesheet"
  />

  <style>
    /* 
      Inspired by Microlino's color scheme and minimal design.
      Adjust colors, fonts, and images as needed to match branding more closely.
    */

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Open Sans", Arial, sans-serif;
      /* Background gradient in Microlino style */
      background: linear-gradient(135deg, #78C6E8 0%, #1A77C2 100%);
      color: #333;
    }

    header {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
    }

    header img {
      max-height: 60px;
    }

    h1 {
      color: #fff;
      margin: 0;
      font-weight: 600;
    }

    /* Container that holds the form */
    .container {
      background-color: #fff;
      max-width: 800px;
      margin: 40px auto;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .container h2 {
      color: #1a77c2;
      margin-top: 0;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }

    .section {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }

    /* Radio and checkbox groups */
    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 5px;
    }

    .radio-group label {
      display: flex;
      align-items: center;
      font-weight: 400;
      gap: 5px;
    }

    /* Terms checkbox */
    .terms {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    /* Button styling */
    button {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 24px;
      background-color: #1a77c2;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #155e96;
    }

    .error {
      color: red;
      margin-top: 10px;
      font-weight: 600;
    }

    /* Message/Response area */
    #message {
      margin-top: 20px;
    }

    pre {
      background: #f7f7f7;
      padding: 10px;
      overflow: auto;
      border-radius: 4px;
      font-size: 0.9rem;
      color: #333;
    }
  </style>
</head>
<body>
  <!-- Optional header or nav section -->
  <header>
    <!-- Replace with your Microlino or brand logo if you have it -->
    <h1>Microlino Insurance Quote</h1>
  </header>

  <div class="container">
    <form id="quoteForm">
      <!-- 1. Vehicle Information -->
      <div class="section">
        <h2>1. Vehicle Information</h2>
        <label>Q1. Which Microlino model would you like to insure?</label>
        <div class="radio-group">
          <label>
            <input type="radio" name="model" value="lite" required />
            Microlino LITE
          </label>
          <label>
            <input type="radio" name="model" value="edition" required />
            Microlino Edition
          </label>
        </div>

        <label>Q2. Please enter your Vehicle Identification Number (VIN):</label>
        <input type="text" name="vin" required placeholder="Enter VIN" />

        <label>Q3. Do you have your Vehicle Registration Number (VRN)? (Optional)</label>
        <input type="text" name="vrn" placeholder="Enter VRN (if available)" />
      </div>

      <!-- 2. Driver Information -->
      <div class="section">
        <h2>2. Driver Information</h2>
        <label>Q4. What is the birthdate of your youngest driver?</label>
        <input type="date" name="driverBirthdate" required />
      </div>

      <!-- 3. Eligibility Check -->
      <div class="section">
        <h2>3. Eligibility Check</h2>
        <label>Q5. Is your vehicle registered as a diplomatic car?</label>
        <div class="radio-group">
          <label><input type="radio" name="diplomaticCar" value="yes" required /> Yes</label>
          <label><input type="radio" name="diplomaticCar" value="no" required /> No</label>
        </div>

        <label>Q6. Are you applying for an interchangeable license plate?</label>
        <div class="radio-group">
          <label><input type="radio" name="interchangeableLicensePlate" value="yes" required /> Yes</label>
          <label><input type="radio" name="interchangeableLicensePlate" value="no" required /> No</label>
        </div>

        <label>Q7. In the past three years, has your motor insurance policy been canceled or terminated by your insurer?</label>
        <div class="radio-group">
          <label><input type="radio" name="policyCancelled" value="yes" required /> Yes</label>
          <label><input type="radio" name="policyCancelled" value="no" required /> No</label>
        </div>

        <label>Q8. How many at-fault liability claims have you had in the last 3 years?</label>
        <div class="radio-group">
          <label><input type="radio" name="claims" value="0" required /> 0</label>
          <label><input type="radio" name="claims" value="1" required /> 1</label>
          <label><input type="radio" name="claims" value="2" required /> 2</label>
          <label><input type="radio" name="claims" value="3+" required /> 3 or +</label>
        </div>
      </div>

      <!-- 4. Policyholder Details -->
      <div class="section">
        <h2>4. Policyholder Details</h2>
        <label>First Name:</label>
        <input type="text" name="firstName" required />

        <label>Last Name:</label>
        <input type="text" name="lastName" required />

        <label>Birthdate:</label>
        <input type="date" name="policyholderBirthdate" required />

        <label>Email Address:</label>
        <input type="email" name="email" required />

        <label>Phone Number:</label>
        <input type="text" name="phone" required />

        <label>Street Address:</label>
        <input type="text" name="street" required />

        <label>House Number:</label>
        <input type="text" name="houseNumber" required />

        <label>City:</label>
        <input type="text" name="city" required />

        <label>ZIP Code:</label>
        <input type="text" name="zip" required />

        <label>Country:</label>
        <input type="text" name="country" value="AT" required />

        <label>Company Name (Optional):</label>
        <input type="text" name="companyName" placeholder="If applicable" />

        <label>Company Number (Optional):</label>
        <input type="text" name="companyNumber" placeholder="If applicable" />
      </div>

      <!-- 5. Insurance Start Date -->
      <div class="section">
        <h2>5. Insurance Start Date</h2>
        <label>Q10. When would you like your insurance to start?</label>
        <input type="date" name="startDate" required />
      </div>

      <!-- Terms & Conditions -->
      <div class="section terms">
        <input type="checkbox" name="terms" required />
        <span>I have read and accept the Terms & Conditions.</span>
      </div>

      <button type="submit">Create Quote</button>
      <div id="message"></div>
    </form>
  </div>

  <script>
    document.getElementById('quoteForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const messageDiv = document.getElementById('message');
      messageDiv.innerHTML = "";

      // Gather form values using FormData
      const formData = new FormData(this);
      const model = formData.get("model"); // "lite" or "edition"
      const vin = formData.get("vin").trim();
      const vrn = formData.get("vrn").trim();
      const driverBirthdate = formData.get("driverBirthdate");

      const diplomaticCar = formData.get("diplomaticCar"); // "yes" or "no"
      const interchangeableLicensePlate = formData.get("interchangeableLicensePlate"); // "yes" or "no"
      const policyCancelled = formData.get("policyCancelled"); // "yes" or "no"
      const claims = formData.get("claims"); // "0", "1", "2", or "3+"

      const firstName = formData.get("firstName").trim();
      const lastName = formData.get("lastName").trim();
      const policyholderBirthdate = formData.get("policyholderBirthdate");
      const email = formData.get("email").trim();
      const phone = formData.get("phone").trim();
      const street = formData.get("street").trim();
      const houseNumber = formData.get("houseNumber").trim();
      const city = formData.get("city").trim();
      const zip = formData.get("zip").trim();
      const country = formData.get("country").trim() || "AT";
      const companyName = formData.get("companyName").trim();
      const companyNumber = formData.get("companyNumber").trim();

      const startDate = formData.get("startDate");

      // Basic validations
      if (!vin) {
        messageDiv.innerHTML = '<p class="error">VIN is required.</p>';
        return;
      }

      // Eligibility checks
      if (diplomaticCar === "yes") {
        messageDiv.innerHTML =
          '<p class="error">Unfortunately, applications for diplomatic cars cannot proceed.</p>';
        return;
      }
      if (interchangeableLicensePlate === "yes") {
        messageDiv.innerHTML =
          '<p class="error">Unfortunately, applications with an interchangeable license plate are not eligible.</p>';
        return;
      }
      if (policyCancelled === "yes") {
        messageDiv.innerHTML =
          '<p class="error">Unfortunately, if your policy has been cancelled or terminated, you cannot proceed.</p>';
        return;
      }
      if (claims === "3+") {
        messageDiv.innerHTML =
          '<p class="error">Unfortunately, having 3 or more at-fault liability claims disqualifies the application.</p>';
        return;
      }

      // Validate youngest driver's age based on the selected model
      const driverBirth = new Date(driverBirthdate);
      const insuranceStart = new Date(startDate);
      let ageAtStart = insuranceStart.getFullYear() - driverBirth.getFullYear();
      const monthDiff = insuranceStart.getMonth() - driverBirth.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && insuranceStart.getDate() < driverBirth.getDate())) {
        ageAtStart--;
      }
      if (model === "lite" && ageAtStart < 15) {
        messageDiv.innerHTML =
          '<p class="error">For Microlino LITE, the youngest driver must be at least 15 years old.</p>';
        return;
      }
      if (model === "edition" && ageAtStart < 17) {
        messageDiv.innerHTML =
          '<p class="error">For Microlino Edition, the youngest driver must be at least 17 years old.</p>';
        return;
      }

      // Build the payload (most values are either constant or come from the form)
      const payload = {
        action: "createQuote",
        payload: {
          productConfigurationId: "microlino",
          partnerId: "67a9f3824ce2c52c73463db6",
          country: "AT",
          language: "de",
          contractPeriod: {
            startDate: startDate,
            timeZone: "Europe/Brussels"
          },
          package: {
            name: "comprehensive",
            coverages: {
              tpl: "default",
              mod: "default",
              "fire-explosion-lightning": "default",
              theft: "default",
              glass: "default",
              "animal-collision": "default",
              "natural-disaster": "default",
              accident: "default",
              vandalism: "default"
            }
          },
          renewal: {
            type: "RENEWAL_TYPE_OPT_IN"
          },
          policyholder: {
            // If a company name is provided, set as a company; otherwise, use person.
            entityType: companyName ? "ENTITY_TYPE_COMPANY" : "ENTITY_TYPE_PERSON",
            firstName: firstName,
            lastName: lastName,
            birthdate: policyholderBirthdate,
            email: email,
            phone: phone,
            address: {
              street: street,
              number: houseNumber,
              zip: zip,
              city: city,
              country: country
            }
          },
          subject: {
            make: "Microlino",
            model: model, // "lite" or "edition"
            vin: vin,
            vrn: vrn || "",
            birthdateYoungestDriver: driverBirthdate,
            anyDriverInsuranceProposalDeclinedOrPolicyCancelled: policyCancelled === "yes",
            interchangeableLicensePlate: interchangeableLicensePlate === "yes",
            diplomaticCar: diplomaticCar === "yes"
          }
        }
      };

      // Add company details if provided
      if (companyName) {
        payload.payload.policyholder.companyName = companyName;
        if (companyNumber) {
          payload.payload.policyholder.vatIn = companyNumber;
        }
      }

      // Call the endpoint
      fetch(
        "https://script.google.com/macros/s/AKfycbz1WluaUb1mLRIw2FCdtmUDB0noSE0I6jOu-WVgXKL6q-UEDL6WFWfs9UXECZPjHEoW/exec",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        }
      )
        .then((response) => response.json())
        .then((data) => {
          console.log("Success:", data);
          messageDiv.innerHTML =
            '<p>Quote created successfully!</p><pre>' +
            JSON.stringify(data, null, 2) +
            "</pre>";
        })
        .catch((error) => {
          console.error("Error:", error);
          messageDiv.innerHTML =
            '<p class="error">An error occurred while creating the quote.</p>';
        });
    });
  </script>
</body>
</html>
