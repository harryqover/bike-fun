<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Review Qover</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Albert+Sans&display=swap');
    body {
      background-color: #3e6ae1;
      background-image: radial-gradient(circle farthest-side at 0 0, #5c85f1, #234ec2);
      font-family: 'Albert Sans', sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 2rem;
      text-align: center;
    }
    .logo {
      max-width: 160px;
      margin-bottom: 30px;
    }
    h1 {
      color: #fff;
      font-size: 2.5rem;
      margin-bottom: 1rem;
      opacity: 0;
      transform: scale(0.5);
      transition: all 1s ease-out;
    }
    h2 {
      color: #fff;
      font-size: 1.25rem;
      font-weight: 400;
      opacity: 0;
      transform: scale(0.5);
      transition: all 1s ease-out;
    }
    .lds-default {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
      margin-top: 2rem;
    }
    .lds-default div {
      position: absolute;
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      animation: lds-default 1.2s linear infinite;
    }
    @keyframes lds-default {
      0%, 100%, 20%, 80% { transform: scale(1); }
      50% { transform: scale(1.5); }
    }
    .countdown {
      color: #fff;
      margin-top: 20px;
      font-size: 1rem;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    @media screen and (max-width: 600px) {
      h1 { font-size: 2rem; }
      h2 { font-size: 1rem; }
    }
  </style>
  <script>
    function getParameterByName(name) {
      name = name.replace(/[\[\]]/g, '\\$&');
      const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
      const results = regex.exec(window.location.href);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
  </script>
</head>
<body>
  <img class="logo" src="https://cdn.prod.website-files.com/632acec7cddd053ca87bbc7a/633d6e3455a345655f175d83_logo-qover_dark.svg" alt="Qover Logo">
  <h1 id="title">Thanks</h1>
  <h2 id="subtitle"></h2>
  <div class="lds-default">
    <div></div><div></div><div></div><div></div><div></div><div></div>
    <div></div><div></div><div></div><div></div><div></div><div></div>
  </div>
  <p id="countdown" class="countdown">Redirecting in 10 seconds...</p>

  <script>
    const h1 = document.getElementById('title');
    const h2 = document.getElementById('subtitle');
    const countdownText = document.getElementById('countdown');

    const rating = parseFloat(getParameterByName("r"));
    const originalRating = rating;
    const zendeskId = getParameterByName("z");
    const cigarId = getParameterByName("c");
    const source = getParameterByName("s");
    const lang = (getParameterByName("l") || "en").toLowerCase();
    const product = getParameterByName("product");
    const partner = getParameterByName("partner");
    const country = getParameterByName("country");
    const minPublicRating = 3;
    if(source == "emailClaimNPS" && rating > 0){
        rating = rating /2;
      }


      console.warn(rating);

        const googleSheetUrl = "https://script.google.com/macros/s/AKfycbyzxKUaL5DCzI3ND_9j4WgLW0-8eXH3wDG276jZD7wbwhTY8ut2FRIMTrkeHUQQOceD/exec";

      var xhr = new XMLHttpRequest();
      xhr.open("POST", googleSheetUrl, true);
      xhr.setRequestHeader("Content-Type", "text/plain;charset=utf-8");
      xhr.timeout = 0;
      xhr.onreadystatechange = function() {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          console.log(this.responseText);
          var ref = ((cigarId)?cigarId:zendeskId);
            if (rating > minPublicRating) {
              //var redirectUrls = ["https://www.trustpilot.com/evaluate/qover.com", "https://g.page/r/CeJV3VPdzwkCEAI/review"];//mix
              //var redirectUrls = ["https://www.trustpilot.com/evaluate/qover.com", "https://www.trustpilot.com/evaluate/qover.com"];//full trustpilot
              var redirectUrls = ["https://g.page/r/CeJV3VPdzwkCEAI/review","https://g.page/r/CeJV3VPdzwkCEAI/review", "https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com","https://www.trustpilot.com/evaluate/qover.com", "https://www.trustpilot.com/evaluate/qover.com"];//90% trustpilot
              //var redirectUrls = ["https://g.page/r/CeJV3VPdzwkCEAI/review","https://g.page/r/CeJV3VPdzwkCEAI/review"];//full Google
            var randomIndex = Math.floor(Math.random() * redirectUrls.length);
            var urlToRedirect = redirectUrls[randomIndex];

            if(cigarId == "Home Protect Tenant"){
              urlToRedirect = "https://www.trustpilot.com/review/protect.immoweb.be"; 
            }
            /* to redirect emailClaimNPS to specific form
            if(source == "emailClaimNPS"){
              urlToRedirect = "https://forms.qover.com/232471409583055?contractReference="+ref+"&language="+lang+"&source="+source;
            }*/

            window.location.replace(urlToRedirect);
              //window.location.replace("https://www.trustpilot.com/evaluate/qover.com");
          } else {
            var urlToRedirect = "https://forms.qover.com/221674111787054?contractReference="+ref+"&language="+lang+"&source="+source;
            if(source == "emailClaimNPS"){
              urlToRedirect = "https://forms.qover.com/232471409583055?contractReference="+ref+"&language="+lang+"&source="+source; 
            }
            window.location.replace(urlToRedirect);
          }
          }
      };
      xhr.send(JSON.stringify({ cigarId: cigarId, rating: originalRating, zendeskId: zendeskId, source: source, product: product, partner: partner, country: country }));

    const translationH1 = {
      fr: "Merci pour vos commentaires !",
      en: "Thank you for your feedback!",
      es: "Gracias por sus comentarios.",
      nl: "Bedankt voor uw feedback!",
      de: "Vielen Dank für Ihr Feedback!",
      it: "Grazie per il vostro feedback!",
      pt: "Obrigado pelo seu feedback!"
    };

    const translationH2Positive = {
      fr: "Laissez un avis public avant le 30 juin et nous ferons un don de 5 € à une association caritative. Ajoutez simplement votre référence Qover dans votre avis.",
      en: "Leave a public review by 30 June and we’ll donate €5 to charity. Just add your Qover reference in your review.",
      es: "Nos encantaría que compartiera su experiencia positiva con otros clientes.",
      nl: "We zouden het geweldig vinden als u uw positieve ervaring met andere klanten zou kunnen delen.",
      de: "Wir würden uns sehr freuen, wenn Sie Ihre positiven Erfahrungen mit anderen Kunden teilen könnten.",
      it: "Saremmo felicissimi se poteste condividere la vostra esperienza positiva con altri clienti.",
      pt: "Ficaríamos muito contentes se pudesse partilhar a sua experiência positiva com outros clientes."
    };

    const translationH2Negative = {
      fr: "Nous serions ravis d'obtenir de plus amples informations.",
      en: "We would love to get more information.",
      es: "Estaremos encantados de recibir más información.",
      nl: "Wij zouden het leuk vinden om meer informatie te ontvangen.",
      de: "Wir würden uns freuen, mehr Informationen zu erhalten.",
      it: "Saremmo lieti di ricevere ulteriori informazioni.",
      pt: "Gostaríamos de obter mais informações."
    };

    h1.textContent = translationH1[lang] || translationH1.en;
    h2.textContent = (rating > minPublicRating) ? (translationH2Positive[lang] || translationH2Positive.en) : (translationH2Negative[lang] || translationH2Negative.en);

    // Animate in
    setTimeout(() => { h1.style.opacity = 1; h1.style.transform = 'scale(1)'; }, 200);
    setTimeout(() => { h2.style.opacity = 1; h2.style.transform = 'scale(1)'; }, 600);
    setTimeout(() => { countdownText.style.opacity = 1; }, 1000);

    // Countdown timer
    let seconds = 10;
    const countdownInterval = setInterval(() => {
      seconds--;
      countdownText.textContent = `Redirecting in ${seconds} seconds...`;
      if (seconds <= 0) clearInterval(countdownInterval);
    }, 1000);
  </script>
</body>
</html>
