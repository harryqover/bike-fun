<html>
	<head>
		<script>
			function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=new RegExp("[\\?\x26]"+a+"\x3d([^\x26#]*)");a=a.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}
		</script>
		<style>
			.lds-default{display:inline-block;position:relative;width:80px;height:80px}.lds-default div{position:absolute;width:6px;height:6px;background:#2F44DD;border-radius:50%;animation:1.2s linear infinite lds-default}.lds-default div:first-child{animation-delay:0s;top:37px;left:66px}.lds-default div:nth-child(2){animation-delay:-.1s;top:22px;left:62px}.lds-default div:nth-child(3){animation-delay:-.2s;top:11px;left:52px}.lds-default div:nth-child(4){animation-delay:-.3s;top:7px;left:37px}.lds-default div:nth-child(5){animation-delay:-.4s;top:11px;left:22px}.lds-default div:nth-child(6){animation-delay:-.5s;top:22px;left:11px}.lds-default div:nth-child(7){animation-delay:-.6s;top:37px;left:7px}.lds-default div:nth-child(8){animation-delay:-.7s;top:52px;left:11px}.lds-default div:nth-child(9){animation-delay:-.8s;top:62px;left:22px}.lds-default div:nth-child(10){animation-delay:-.9s;top:66px;left:37px}.lds-default div:nth-child(11){animation-delay:-1s;top:62px;left:52px}.lds-default div:nth-child(12){animation-delay:-1.1s;top:52px;left:62px}@keyframes lds-default{0%,100%,20%,80%{transform:scale(1)}50%{transform:scale(1.5)}}
		</style>
	</head>
	<body>
		<h1></h1>
		<h2></h2>
		<div class="lds-default"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
		<script>
			var originalRating = getParameterByName("r");
			var rating = originalRating;
			var zendeskId = getParameterByName("z");
			var cigarId = getParameterByName("c");
			var source = getParameterByName("s");
			var lang = getParameterByName("l");
			var product = getParameterByName("product");
			var partner = getParameterByName("partner");
			var country = getParameterByName("country");
			var minPublicRating = 3;
			const h1 = document.querySelector('h1');
			const h2 = document.querySelector('h2');

			if(source == "emailClaimNPS" && rating > 0){
				rating = rating /2;
			}


			console.warn(rating);

		    var googleSheetUrl = "https://script.google.com/macros/s/AKfycbyzxKUaL5DCzI3ND_9j4WgLW0-8eXH3wDG276jZD7wbwhTY8ut2FRIMTrkeHUQQOceD/exec";

			var xhr = new XMLHttpRequest();
			xhr.open("POST", googleSheetUrl, true);
			xhr.setRequestHeader("Content-Type", "text/plain;charset=utf-8");
			xhr.timeout = 0;
			xhr.onreadystatechange = function() {
				if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
					console.log(this.responseText);

				    if (rating > minPublicRating) {
				    	//var redirectUrls = ["https://www.trustpilot.com/evaluate/qover.com", "https://g.page/r/CeJV3VPdzwkCEAI/review"];
				    	var redirectUrls = ["https://www.trustpilot.com/evaluate/qover.com", "https://www.trustpilot.com/evaluate/qover.com"];
						var randomIndex = Math.floor(Math.random() * redirectUrls.length);
						window.location.replace(redirectUrls[randomIndex]);
					  	//window.location.replace("https://www.trustpilot.com/evaluate/qover.com");
					} else {
						var ref = ((cigarId)?cigarId:zendeskId);
						lang = lang.toLowerCase();
						window.location.replace("https://form.jotform.com/221674111787054?contractReference="+ref+"&language="+lang);
					}
			    }
			};
			xhr.send(JSON.stringify({ cigarId: cigarId, rating: originalRating, zendeskId: zendeskId, source: source, product: product, partner: partner, country: country }));

			if (rating > minPublicRating) {
				h1.textContent = "Thanks for your feedback!";
				h2.textContent = "If you're feeling especially satisfied with our service, we would be over the moon if you could share your positive experience with other customers. Not only would it help us spread the word to other potential customers, but it would also make us feel warm and fuzzy inside.";
			} else {
				h1.textContent = "Thanks for your feedback!";
				h2.textContent = 'We are loading our form to get more information';
			}

			console.log("https://harryqover.github.io/bike-fun/reviewQover?r=8&z=56788&c=BE109817398&s=emailClaimNPS");
		</script>
	</body>
</html>